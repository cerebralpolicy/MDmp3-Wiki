{%- assign flag_codes = 'https://flagcdn.com/en/codes.json' %}
{%- assign artists = site.data.tracklist -%}

{% for artist in artists | sort: artist%}
{%- for iso_code in flag_codes -%}
{%- if iso_code[1] == artist.origin -%}
{%- assign flagURL = '"https://flagcdn.com/' | append: iso_code[0] | append: '.svg"' -%}
{%- continue -%}
{%- endif -%}
<h2 id="#{{artist}}">{{artist}}</h2>
<div style="align-content: end;"><img src={{flagURL}} width="96px" /></div>
{% assign thisArtistsTracks = artist.track | sort:"name"| sort: "year" %}
<table>
    <tr>
        <th style="width: 20%;">Name</th>
        <th style="width: 24%;">Album</th>
        <th style="width: 4%;">Year</th>
        <th style="width: 35%;">Spotify</th>
        <th>Contexts</th>
    </tr>
    {%- for row in thisArtistsTracks -%}
    {%- assign context-icos = "" -%}
    <tr>
        {%- for pair in row  -%}
        {% if pair[0] != "artist" and pair[0] != "battle" and pair[0] != "exploration" and pair[0] != "boss" and pair[0] != "menu" and pair[0] != "special" %}
        <td>
            {%- if pair[0] == "spotifyID" -%}
            {%- assign songID = pair[1] -%}
            {%- assign songLink = "https://open.spotify.com/embed/track/" | append: songID | append: "?utm_source=generator&theme=0" -%}
            <iframe style="border-radius:12px" src="{{songLink}}" width="100%" height="96" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
            {%- else -%}
            {{ pair[1] -}}
            {% endif -%}
        </td>
        {%- elsif pair[0] != "artist" -%}
        {%- assign alt-txt = pair[0] | capitalize -%}
        {%- assign ico = '"assets/context-icons/' | append: alt-txt | append: '.svg"' -%}
        {%- assign context-ico = "<img src=" | append: ico | append: ' width="32px" height="32px" title="' | append: alt-txt | append: '"/>&nbsp' -%}
        {%- if pair[1] -%}
        {%- assign context-icos = context-icos | append: context-ico -%}
        {%- else -%}
        {%- endif -%}
        {%- endif -%}
        {%- endfor %}
        <td>{{ context-icos }}</td>
    </tr>
    {% endfor %}
</table>
{% endfor %}